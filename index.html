<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Viral+ ‚Äî R√©seau social</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Icons & PWA -->
  <link rel="icon" href="icons/viral-32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" sizes="192x192" href="icons/viral-192.png">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f172a">

  <!-- Styles -->
  <style>
    :root{
      --bg1:#0f172a; --bg2:#1e293b; --panel:#0b1220; --card:#111827;
      --text:#e5e7eb; --muted:#94a3b8; --primary:#3b82f6; --primary-2:#2563eb;
      --accent:#22d3ee; --success:#22c55e; --danger:#ef4444; --warning:#f59e0b;
      --line1:#f59e0b; --line2:#22d3ee; --line3:#a3e635; --glow:0 0 24px rgba(34,211,238,.18);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter,Segoe UI,Arial,sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, var(--bg1) 0%, var(--bg2) 60%, #0a0f1c 100%);
      color:var(--text);
    }
    .topbar{
      position:sticky; top:0; z-index:50; display:flex; align-items:center; justify-content:space-between;
      background:linear-gradient(90deg,#0f172a,#1e293b); border-bottom:1px solid rgba(255,255,255,.06);
      padding:12px 16px; backdrop-filter:blur(6px);
    }
    .brand{ font-weight:800; letter-spacing:.3px; font-size:20px }
    .badges{ display:flex; gap:8px }
    .badge{ background:#0b1220; border:1px solid rgba(255,255,255,.08); color:#cbd5e1; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700; box-shadow:var(--glow) }
    .search{ display:flex; gap:8px; align-items:center }
    .search input{ background:#0b1220; border:1px solid rgba(255,255,255,.08); color:#fff; padding:8px 10px; border-radius:12px; width:280px }

    .tabs{
      display:flex; gap:8px; padding:10px; justify-content:center;
      background:#0b1220; border-bottom:1px solid rgba(255,255,255,.06);
    }
    .tab{
      background:var(--primary); border:none; color:#fff; padding:10px 14px; border-radius:14px; font-weight:700; cursor:pointer;
      transition: background .25s, transform .25s, box-shadow .25s; box-shadow:0 8px 20px rgba(59,130,246,.25)
    }
    .tab:hover{ background:var(--primary-2); transform:translateY(-1px) }
    .tab.active{ background:var(--accent); color:#001; box-shadow:0 8px 20px rgba(34,211,238,.25) }

    main{ max-width:1100px; margin:auto; padding:16px }
    .panel{
      background:linear-gradient(180deg, #0f172a, #0b1220);
      border:1px solid rgba(255,255,255,.06);
      border-radius:18px; padding:16px; margin-bottom:16px; box-shadow:var(--glow)
    }
    .row{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px }
    input, textarea{
      width:100%; padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
      background:#0b1220; color:#fff; margin-top:6px;
    }
    input::placeholder, textarea::placeholder{ color:#94a3b8 }
    .btn{
      background:var(--primary); color:#fff; border:none; border-radius:12px; padding:10px 14px; font-weight:800; cursor:pointer;
      transition: background .25s, transform .25s, box-shadow .25s; box-shadow:0 8px 20px rgba(59,130,246,.25)
    }
    .btn:hover{ background:var(--primary-2); transform:translateY(-1px) }
    .btn.danger{ background:var(--danger) }
    .btn.success{ background:var(--success); color:#0f172a }
    .btn.accent{ background:var(--accent); color:#0f172a }
    .muted{ color:#94a3b8 }

    .feed{ display:flex; flex-direction:column; gap:12px }
    .post{
      background:#0b1220; border:1px solid rgba(255,255,255,.06);
      border-radius:14px; padding:12px; animation:fadeIn .35s ease; will-change:transform,opacity
    }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }
    .post .meta{ font-size:12px; color:var(--muted); margin-bottom:6px }
    .post .author{ font-weight:700; color:#cbd5e1 }
    .post img,.post video{ width:100%; border-radius:12px; margin-top:8px; background:#000 }

    .actions{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px }
    .actions .btn{ display:flex; align-items:center; gap:6px }
    .actions .like{ background:var(--success); color:#0f172a }
    .actions .dislike{ background:var(--danger) }
    .actions .comment{ background:#1e293b }
    .actions .share{ background:var(--accent); color:#0f172a }

    .battery{ width:100%; height:44px; border:2px solid var(--accent); border-radius:12px; position:relative; overflow:hidden; margin-top:10px; box-shadow:var(--glow) }
    .energy{ height:100%; width:0%; background:linear-gradient(90deg,#22d3ee,#3b82f6); transition:width .4s ease }
    .spark{ position:absolute; inset:0; background:radial-gradient(circle,#fff 10%,transparent 60%); opacity:.12; animation:spark .6s infinite alternate ease-in-out }
    @keyframes spark{ from{transform:translateX(-16px)} to{transform:translateX(16px)} }

    .legend{ display:flex; gap:12px; flex-wrap:wrap; margin-top:8px; font-size:13px; color:#cbd5e1 }
    .legend .item{ display:flex; align-items:center; gap:6px }
    .dot{ width:10px; height:10px; border-radius:50% }
    .dot.text{ background:var(--line1) } .dot.video{ background:var(--line2) } .dot.interact{ background:var(--line3) }

    canvas{ width:100%; height:280px; background:#0b1220; border:1px solid rgba(255,255,255,.06); border-radius:12px; margin-top:10px; display:block }

    .toast{ position:fixed; right:16px; bottom:16px; z-index:60; display:flex; flex-direction:column; gap:8px }
    .toast .msg{ background:#0b1220; border:1px solid rgba(34,211,238,.35); color:#22d3ee; padding:10px 12px; border-radius:12px; box-shadow:var(--glow); min-width:240px; font-weight:700; transition:opacity .6s, transform .6s }

    .contacts{ display:flex; flex-direction:column; gap:8px; max-height:260px; overflow:auto }
    .contact{ display:flex; align-items:center; justify-content:space-between; background:#0b1220; border:1px solid rgba(255,255,255,.06); padding:8px; border-radius:12px; cursor:pointer }
    .contact .name{ font-weight:700; color:#cbd5e1 } .contact .status{ font-size:12px; color:#94a3b8 }

    .chatbox{ flex:1; display:flex; flex-direction:column; gap:8px }
    .chat{ background:#0b1220; border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:10px; max-height:260px; overflow:auto }
    .bubble{ background:#0f172a; border:1px solid rgba(255,255,255,.08); padding:8px; border-radius:10px; margin:6px 0; max-width:80% }
    .bubble.me{ background:var(--accent); color:#0f172a; margin-left:auto }
    .composer{ display:flex; gap:8px; }
    .composer input{ flex:1 }

    .rtc{ display:flex; gap:8px; }
    .rtc video{ width:48%; background:#000; border-radius:12px }

    .profile-card{ display:flex; gap:12px; align-items:center }
    .avatar img, .avatar video{ width:96px; height:96px; border-radius:50%; object-fit:cover; background:#000 }
  </style>

  <!-- AdSense (optionnel) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8210705555437597" crossorigin="anonymous"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">‚ö° Viral+</div>
    <div class="search">
      <input id="searchInput" placeholder="Rechercher des utilisateurs ou des posts‚Ä¶"/>
      <button class="btn" id="searchBtn">Rechercher</button>
    </div>
    <div class="badges">
      <div class="badge" id="badge-user">Invit√©</div>
      <div class="badge" id="badge-pop">Pop: 0</div>
      <div class="badge" id="badge-posts">Posts: 0</div>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" data-tab="home">Accueil</button>
    <button class="tab" data-tab="publish">Publier</button>
    <button class="tab" data-tab="pop">Popularit√©</button>
    <button class="tab" data-tab="messages">Messages</button>
    <button class="tab" data-tab="profile">Profil</button>
  </nav>

  <main>
    <!-- Auth -->
    <section id="auth" class="panel">
      <h2>Connexion / Inscription</h2>
      <input id="auth-email" placeholder="Email"/>
      <input id="auth-pass" type="password" placeholder="Mot de passe"/>
      <div class="row">
        <button class="btn success" id="signupBtn">Cr√©er un compte</button>
        <button class="btn accent" id="loginBtn">Se connecter</button>
      </div>
      <p class="muted">Gratuit (Firebase Spark). Donn√©es en ligne, temps r√©el.</p>
    </section>

    <!-- App -->
    <section id="app" style="display:none">
      <!-- Home -->
      <section id="home" class="panel">
        <h2>Fil d‚Äôactualit√©</h2>
        <div id="feed" class="feed"></div>
      </section>

      <!-- Publish -->
      <section id="publish" class="panel" style="display:none">
        <h2>Publier</h2>
        <textarea id="postText" placeholder="Exprime-toi‚Ä¶"></textarea>
        <input type="file" id="postMedia" accept="image/*,video/*"/>
        <div class="row">
          <button class="btn accent" id="publishBtn">Publier</button>
          <button class="btn danger" id="clearPublishBtn">Effacer</button>
        </div>
 <div class="spark"></span>Interactions</div>
           
              <input id="dmText" placeholder="√âcrire un message‚Ä¶"/>
            <div class="callbar">
            </div>
        <h2>Profil
            <video id="avatarVideo" style="display:none" autoplay loop muted playsinline> <div class="profile-info"> </div>
        
          </select> { initializeApp } from "https://js/10.12.2/firebase } from "https://Id: "1:719277208Element("div");
 = "translateY(6px(btn=>{
      btnById(s).style.display });
        tabsloginBtn").onclick){ notify("Rempl; }
      try{
        const cred = await createUserWithEmail", cred.user.uid.toLowerCase(),
        notify("Compte cr√©√©");
      if(!email || !pass){ notify("Ident.display = "block(user.uid);
     .getElementById(" const feedEl = document.getElementById(".data();
      const‚ù§Ô∏è ${p.likes || Snap.id, (p.likes = ()=> commentPost(docSnap.id);
      actions.querySelector.forEach(c=>{
         ;
    }
    function feedEl.innerHTML = "post";
         El.appendChild(empty);
          return){ notify("Connect file = document[0];
      if(!text if(file && file("Fichier trop volum        const path, file);
       ;
      }
      await.email,
        text comments: [],
             await bump√©e");
    }
    document    };
    asyncPost(id, val){
           const comments url=window.location, url });
       (url)}&text=${encodePop, 100) + "%";
0;d<=24;d++){ const y = padding + (h/24)*d; ctx.moveTo(padding,y); ctx.lineTo(padding+w,y); }
();

      ctx.fill255,255,.7)"; ctx.save(); ctx.translate const getVar = vLine(histVideo, get plotLine(histInteractStyle = color; ctx.beginPath();
        data.forEach((v,i)=>{
          + (w/(data.length-1))*i;
          + (h - (v/maxVal(doc(db, "profiles let t=0,v=0,i=0 const p = d.dataText.push(t); hist = await getDoc(ref = Math.max(0, (snap, -1);
    }, 500    .actions .comment%; height:44px; border:100%; width:0%;-gradient(90deg,#; inset:0; background:translateX(-16pxtranslateX(16px)}:100%; height:280; display:flex; flex700; transition:{ display:flex; align:column; gap:8px:1px solid rgba(255,:#0f172a; margin:12px }

    .profile
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8210705555437597" crossorigin="anonymous"><div class="badges">
        <button class="btn success" id="signupBtn">
        <button class="btn accent" id="loginBtn">
        <div class="battery">
        <h2>Messages</div>
           
              <button class="btn" id="recBtn">
            <div class="rtc">
              <video id="localVideo" autoplay muted playsinline> <video id="remoteVideo" autoplay playsinline>
        <h2>Profil</h2>
        <div class="profile-card"></video>
          </div>
        
            <option value="video">Vid√©o de profil</option>Mettre √† jour</button>
  <script type="module"> SDKs */
    import { initializeApp } from "https://-app.js";
    importPassword, signInDoc, doc, update    import { getStorage, ref as sRef, uploadBytesjs/10.12.2/firebase */
    const firebaseQ",
      authDomain: "viralplus-dfe4a.firebaseapp.com",
      project",
      messagingSenderId: "719277 };

    /* Init const db = getFirestore.textContent = message }
    const tabs.addEventListener        const id = btn.dataset.tab.forEach(b=> b.class.getElementById("signupBtn").onclick = document.getElementById("auth-pass"). if(!email || !pass, email, pass);
Doc(doc(db, "profiles("Erreur: " + e.message      const passifiants manquants").style.displaybadge-user").textUrl){
        if const actions = <button class="btn comment">üîó Partager</button>Snap.id, (p.likes||0)+1);
      actions.querySelector(".(docSnap.id, (p.dis(p.text || "", location      if(p.comments"));
      onSnapshot feedEl.innerHTML;
      if(!user){ notify("Connecte-toi pour publier"); return; }
      const text = document.getElementById("postText").value.trim();
      const file = document.getElementById("postMedia").files[0];
      if(!text && !file){ notify("√âcris quelque chose ou ajoute un m√©dia"); return; }
      if(file && file.size > 50 * 1024 * 1024){ notify("Fichier trop volumineux (max 50MB)"); return; }

      let mediaUrl = null, mediaType = null;
      if(file){
        const path = `posts/${user.uid}/${Date.now()}_${file.name}`;
        const ref = sRef(storage, path);
        await uploadBytes(ref, file);
        mediaUrl = await getDownloadURL(ref);
        mediaType = file.type;
      }
      await addDoc(collection(db, "posts"), {
        authorUid: user.uid,
        authorEmail: user.email,
        text,
        textLower: (text || "").toLowerCase(),
        mediaUrl,
        mediaType,
        likes: 0,
        dislikes: 0,
        comments: [],
        createdAt: serverTimestamp(),
        type: mediaType?.startsWith("video") ? "video" : "text"
      });
      await bumpPopularity(user.uid, 5);
      document.getElementById("postText").value = "";
      document.getElementById("postMedia").value = "";
      notify("Publication ajout√©e");
    }
    document.getElementById("publishBtn").onclick = publish;
    document.getElementById("clearPublishBtn").onclick = ()=>{
      document.getElementById("postText").value = "";
      document.getElementById("postMedia").value = "";
    };
    async function likePost(id, val){
      const ref = doc(db, "posts", id);
      await updateDoc(ref, { likes: val });
      const user = auth.currentUser;
      if(user) await bumpPopularity(user.uid, 2);
      notify("Tu as aim√© une publication");
    }
    async function dislikePost(id, val){
      const ref = doc(db, "posts", id);
      await updateDoc(ref, { dislikes: val });
      const user = auth.currentUser;
      if(user) await bumpPopularity(user.uid, -1);
      notify("Tu n‚Äôas pas aim√© une publication");
    }
    async function commentPost(id){
      const text = prompt("Commentaire");
      if(!text || !text.trim()) return;
      const user = auth.currentUser;
      const ref = doc(db, "posts", id);
      const snap = await getDoc(ref);
      const data = snap.data();
      const comments = data.comments || [];
      comments.push({ author: user?.email || "Anonyme", text: text.trim(), ts: Date.now() });
      await updateDoc(ref, { comments });
      if(user) await bumpPopularity(user.uid, 1);
      notify("Commentaire ajout√©");
    }
    function sharePost(msg="", url=window.location.href){
      if (navigator.share) {
        navigator.share({ title:"Viral+", text:msg, url });
        return;
      }
      window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, "_blank");
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, "_blank");
      window.open(`https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(msg)}`, "_blank");
    }

    /* Popularit√© + triple courbe */
    const energyEl = document.getElementById("energy");
    const graph = document.getElementById("graph");
    const ctx = graph.getContext("2d");
    let histText = Array(24).fill(0), histVideo = Array(24).fill(0), histInteract = Array(24).fill(0);
    let currentPop = 0;

    function draw(){
      energyEl.style.width = Math.min(currentPop, 100) + "%";
      ctx.clearRect(0,0,graph.width,graph.height);
      ctx.lineJoin = "round"; ctx.lineCap = "round";
      const padding = 32, w = graph.width - padding*2, h = graph.height - padding*2;

      ctx.strokeStyle = "rgba(255,255,255,.15)"; ctx.lineWidth = 1; ctx.beginPath();
      for(let m=0;m<=12;m++){ const x = padding + (w/12)*m; ctx.moveTo(x,padding); ctx.lineTo(x,padding+h); }
      for(let d=0;d<=24;d++){ const y = padding + (h/24)*d; ctx.moveTo(padding,y); ctx.lineTo(padding+w,y); }
      ctx.stroke();

      ctx.fillStyle = "rgba(255,255,255,.7)"; ctx.font = "12px Arial";
      ctx.fillText("Mois ‚Üí", padding + w - 50, padding - 10);
      ctx.save(); ctx.translate(padding - 18, padding + 20); ctx.rotate(-Math.PI/2); ctx.fillText("Jours ‚Üì", 0, 0); ctx.restore();

      const maxVal = Math.max(100, ...histText, ...histVideo, ...histInteract);
      const getVar = v => getComputedStyle(document.documentElement).getPropertyValue(v).trim();

      plotLine(histText, getVar('--line1') || "#f59e0b");
      plotLine(histVideo, getVar('--line2') || "#22d3ee");
      plotLine(histInteract, getVar('--line3') || "#a3e635");

      function plotLine(data, color){
        ctx.strokeStyle = color; ctx.lineWidth = 2; ctx.beginPath();
        data.forEach((v,i)=>{
          const x = padding + (w/(data.length-1))*i;
          const y = padding + (h - (v/maxVal)*h);
          if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        });
        ctx.stroke();
      }
    }
    function subscribePopularity(uid){
      onSnapshot(doc(db, "profiles", uid), (snap)=>{
        const data = snap.data();
        currentPop = data?.pop || 0;
        document.getElementById("badge-pop").textContent = "Pop: " + currentPop;
        draw();
      });
      const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
      onSnapshot(q, (snap)=>{
        let t=0,v=0,i=0;
        snap.forEach(d=>{
          const p = d.data();
          if(p.type==="video") v++; else t++;
          i += (p.likes||0) + (p.dislikes||0) + (p.comments?.length||0);
        });
        histText.push(t); histText.shift();
        histVideo.push(v); histVideo.shift();
        histInteract.push(i); histInteract.shift();
        draw();
      });
    }
    async function bumpPopularity(uid, delta){
      const ref = doc(db, "profiles", uid);
      const snap = await getDoc(ref);
      if(!snap.exists()){
        await setDoc(ref, { pop: Math.max(0, delta), email: auth.currentUser?.email || "", createdAt: serverTimestamp() });
      }else{
        const val = Math.max(0, (snap.data().pop||0) + delta);
        await updateDoc(ref, { pop: val });
      }
    }
    setInterval(async ()=>{
      const user = auth.currentUser;
      if(!user) return;
      await bumpPopularity(user.uid, -1);
    }, 5000);

    /* Contacts & DM */
    const contactsEl = document.getElementById("contacts");
    const chatEl = document.getElementById("chat");
    let dmTarget = null, unsubscribeChat = null;

    function subscribeContacts(){
      onSnapshot(collection(db, "profiles"), (snap)=>{
        contactsEl.innerHTML = "";
        snap.forEach(d=>{
          const u = d.id;
          if(auth.currentUser && u === auth.currentUser.uid) return;
          const el = document.createElement("div");
          el.className = "contact";
          el.innerHTML = `<div class="name">${d.data().email || "Utilisateur"}</div><div class="status">En ligne</div>`;
          el.onclick = ()=> openDM(u);
          contactsEl.appendChild(el);
        });
      });
   
