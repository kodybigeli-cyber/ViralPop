<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Viral+ Ultimate</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="top-bar">
  <div id="stats-bar">
    <span id="likesCount">0 Likes</span>
    <span id="popCount">0 Pop+</span>
    <div id="badge-bar"><div id="badge-fill"></div></div>
  </div>
</div>

<div id="feed-container">

  <!-- VIDEO 1 -->
  <div class="video-wrapper">
    <video src="video1.mp4" class="feed-video" autoplay muted loop></video>

    <canvas class="chart-canvas"></canvas>

    <div class="actions-bar">
      <button onclick="like(this)">â¤ï¸ <span>0</span></button>
      <button onclick="popPlus(this)">âš¡ Pop+</button>
      <button onclick="boost(this)">ğŸš€ Boost</button>
      <button onclick="toggleComment(this)">ğŸ’¬</button>
    </div>

    <div class="comment-box hidden">
      <input type="text" placeholder="Ã‰crire un commentaire">
      <button onclick="sendComment(this)">Envoyer</button>
      <div class="comments-list"></div>
    </div>

    <div class="influencer-badge">â­</div>
  </div>

  <!-- VIDEO 2 -->
  <div class="video-wrapper">
    <video src="video2.mp4" class="feed-video" autoplay muted loop></video>

    <canvas class="chart-canvas"></canvas>

    <div class="actions-bar">
      <button onclick="like(this)">â¤ï¸ <span>0</span></button>
      <button onclick="popPlus(this)">âš¡ Pop+</button>
      <button onclick="boost(this)">ğŸš€ Boost</button>
      <button onclick="toggleComment(this)">ğŸ’¬</button>
    </div>

    <div class="comment-box hidden">
      <input type="text" placeholder="Ã‰crire un commentaire">
      <button onclick="sendComment(this)">Envoyer</button>
      <div class="comments-list"></div>
    </div>

    <div class="influencer-badge">â­</div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>

/********* INTERACTIONS *********/
function like(btn){
  const span = btn.querySelector("span");
  span.innerText = parseInt(span.innerText) + 1;
  updateStats(btn);
}

function popPlus(btn){
  const wrapper = btn.closest(".video-wrapper");
  wrapper.dataset.pop = wrapper.dataset.pop ? parseInt(wrapper.dataset.pop)+1 : 1;
  updateStats(btn);
}

function boost(btn){
  alert("Boost sponsorisÃ© activÃ© !");
}

function toggleComment(btn){
  const box = btn.closest(".video-wrapper").querySelector(".comment-box");
  box.classList.toggle("hidden");
}

function sendComment(btn){
  const input = btn.previousElementSibling;
  const text = input.value.trim();
  if(text === "") return;
  const list = btn.parentElement.querySelector(".comments-list");
  const p = document.createElement("p");
  p.innerText = text;
  list.appendChild(p);
  input.value = "";
}

/********* BADGE VIP & STATS *********/
function updateStats(btn){
  const wrapper = btn.closest(".video-wrapper");
  const likes = wrapper.querySelector(".actions-bar button span").innerText;
  const pops = wrapper.dataset.pop || 0;
  wrapper.querySelector(".influencer-badge").innerText = (parseInt(likes)+parseInt(pops))>=50 ? "VIP" : "â­";

  const fillPercent = Math.min(100, (parseInt(pops)/50)*100);
  wrapper.querySelector("#badge-fill")?.style.width = fillPercent+"%";
}

/********* AUTOPLAY / PAUSE VIDÃ‰OS *********/
const observer = new IntersectionObserver(entries=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting) entry.target.play();
    else entry.target.pause();
  });
},{threshold:0.75});

const videos = document.getElementsByClassName("feed-video");
Array.from(videos).forEach(v=>observer.observe(v));

/********* GRAPHE COURBES BOURSE *********/
function initCharts(){
  const wrappers = document.querySelectorAll(".video-wrapper");
  wrappers.forEach(wrapper=>{
    const ctx = wrapper.querySelector(".chart-canvas").getContext("2d");
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: Array.from({length:20},(_,i)=>i+1),
        datasets: [
          {
            label: 'Likes',
            data: Array.from({length:20},()=>Math.floor(Math.random()*50)),
            borderColor: '#00CFFF',
            borderWidth: 2,
            fill:false
          },
          {
            label: 'Pop+',
            data: Array.from({length:20},()=>Math.floor(Math.random()*50)),
            borderColor: '#B400F9',
            borderWidth: 2,
            fill:false
          },
          {
            label: 'Boost',
            data: Array.from({length:20},()=>Math.floor(Math.random()*20)),
            borderColor: '#FFD700',
            borderWidth: 2,
            fill:false
          }
        ]
      },
      options:{
        responsive:true,
        plugins:{
          legend:{display:false}
        },
        scales:{
          x:{display:false},
          y:{display:false}
        },
        elements:{
          point:{radius:0}
        }
      }
    });
  });
}
window.addEventListener("load", initCharts);

</script>
</body>
      </html>
